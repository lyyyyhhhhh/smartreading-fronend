<template>
  <view>
    <!-- çŠ¶æ€æ å ä½ -->
    <view class="status_bar">
      <view class="top_view"></view>
    </view>
    <view style="display: flex; flex-direction: column; margin: 30rpx 30rpx 0;">
      <view style="font-weight: bold; font-size: 30rpx;">æ¨èæ¦œå•</view>
      <view style="font-size: 20rpx; margin-top: 10rpx;">ç²¾é€‰é«˜äººæ°”ä¼˜è´¨æ–‡ç« </view>
    </view>
    <view class="page">
      <view class="header">
        <view class="header-title">
          <image src="/static/trophy.png"></image>
          <text>æ–‡ç« çƒ­ç‚¹æ’è¡Œæ¦œ</text>
        </view>
      </view>
      <view class="ranking">
        <view class="ranking-sum" @click="torankdetail('çƒ­ç‚¹æ¦œå•')">
          <view class="ranking-list">
            <view class="ranking-title">
              <text>æ’å</text>
              <text>æ–‡ç« </text>
              <text>çƒ­åº¦å€¼</text>
            </view>
            <view class="ranking-list-item" v-for="(item, key) in hotRankList.slice(0, 5)" :key="key">
              <view v-if="key < 3" class="ranking-list-number">
                <image :src="'/static/' + (key + 1) + '.png'"></image>
              </view>
              <view v-else class="ranking-list-number">
                <text>{{ key + 1 }}</text>
              </view>
              <view class="ranking-list-nickname">
                <image :src="item.pic"></image>
                <text>{{ item.title }}</text>
              </view>
              <text class="ranking-list-score">{{item.heat}}</text>
            </view>
          </view>
          <view class="separator"></view>

          <view class="ranking-list">
            <view class="ranking-title">
              <text>æ’å</text>
              <text>æ–‡ç« </text>
              <text>çƒ­åº¦å€¼</text>
            </view>
            <view class="ranking-list-item" v-for="(item, key) in hotRankList.slice(5, 10)" :key="key">
              <view class="ranking-list-number">
                <text>{{ key + 6 }}</text>
              </view>
              <view class="ranking-list-nickname">
                <image :src="item.pic"></image>
                <text>{{ item.title }}</text>
              </view>
              <text class="ranking-list-score">{{item.heat}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <view style="display: flex; flex-direction: column; margin: 30rpx;">
      <view style="font-weight: bold; font-size: 30rpx;">æœ€æ–°æ¦œå•</view>
      <view style="font-size: 20rpx; margin-top: 10rpx;">ç»™ä½ çš„çˆ±å¥½å¢æ·»å…‰å½©</view>
    </view>
    <view class="ranklist">
      <view class="container">
        <view class="row">
          <view class="item" @click="torankdetail(ranklist[0].name)">
            <view style="display: flex; flex-direction: column;">
              <view
                  style="background-color: #EAEFF1;  display: flex; flex-direction: row; align-items: flex-end; justify-content: center; margin-top: 30rpx;">
                <image :src="ranklist[0].pics[1]" style="width: 80rpx; height: 180rpx;"
                       mode="aspectFill"></image>
                <image :src="ranklist[0].pics[0]" style="width: 140rpx; height: 200rpx;"></image>
                <image :src="ranklist[0].pics[2]" style="width: 80rpx; height: 180rpx;"
                       mode="aspectFill"></image>
              </view>
              <view
                  style="background-color: #808A9F; height: 80rpx; color: white; display: flex; flex-direction: column; justify-content: center; font-size: 22rpx;">
                <text>{{ ranklist[0].name }}</text>
              </view>
            </view>
          </view>
          <view class="item" @click="torankdetail(ranklist[1].name)">
            <view style="display: flex; flex-direction: column;">
              <view
                  style="background-color: #EAEFF1;  display: flex; flex-direction: row; align-items: flex-end; justify-content: center; margin-top: 30rpx;">
                <image :src="ranklist[1].pics[1]" style="width: 80rpx; height: 180rpx;"
                       mode="aspectFill"></image>
                <image :src="ranklist[1].pics[0]" style="width: 140rpx; height: 200rpx;"></image>
                <image :src="ranklist[1].pics[2]" style="width: 80rpx; height: 180rpx;"
                       mode="aspectFill"></image>
              </view>
              <view
                  style="background-color: #808A9F; height: 80rpx; color: white; display: flex; flex-direction: column; justify-content: center; font-size: 22rpx;">
                <text>{{ ranklist[1].name }}</text>
              </view>
            </view>
          </view>
        </view>
        <view class="row">
          <view class="item" @click="torankdetail(ranklist[2].name)">
            <view style="display: flex; flex-direction: column;">
              <view
                  style="background-color: #EAEFF1;  display: flex; flex-direction: row; align-items: flex-end; justify-content: center; margin-top: 30rpx;">
                <image :src="ranklist[2].pics[1]" style="width: 80rpx; height: 180rpx;"
                       mode="aspectFill"></image>
                <image :src="ranklist[2].pics[0]" style="width: 140rpx; height: 200rpx;"></image>
                <image :src="ranklist[2].pics[2]" style="width: 80rpx; height: 180rpx;"
                       mode="aspectFill"></image>
              </view>
              <view
                  style="background-color: #808A9F; height: 80rpx; color: white; display: flex; flex-direction: column; justify-content: center; font-size: 22rpx;">
                <text>{{ ranklist[2].name }}</text>
              </view>
            </view>
          </view>
          <view class="item" @click="torankdetail(ranklist[3].name)">
            <view style="display: flex; flex-direction: column;">
              <view
                  style="background-color: #EAEFF1;  display: flex; flex-direction: row; align-items: flex-end; justify-content: center; margin-top: 30rpx;">
                <image :src="ranklist[3].pics[1]" style="width: 80rpx; height: 180rpx;"
                       mode="aspectFill"></image>
                <image :src="ranklist[3].pics[0]" style="width: 140rpx; height: 200rpx;"></image>
                <image :src="ranklist[3].pics[2]" style="width: 80rpx; height: 180rpx;"
                       mode="aspectFill"></image>
              </view>
              <view
                  style="background-color: #808A9F; height: 80rpx; color: white; display: flex; flex-direction: column; justify-content: center; font-size: 22rpx;">
                <text>{{ ranklist[3].name }}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <view style="display: flex; flex-direction: column; margin: 30rpx;">
      <view style="font-weight: bold; font-size: 30rpx;">è¯»ç‰©æ¨è</view>
      <view style="font-size: 20rpx; margin-top: 10rpx;">æœ€å¥½çš„è¯»ç‰©æ¨èç»™æœ€å¥½çš„ä½ </view>
    </view>
    <view class="recommendedreadingmaterial" style="display: flex; flex-direction: column;">
      <view style="height: 300rpx; margin-bottom: 2rpx; padding: 40rpx;" v-for="(item, index) in readingmaterials"
            :key="index" @click="tomaterialdetail(item.homeurl)">
        <view style="display: flex; flex-direction: row;">
          <view>
            <image :src="item.pic" style="width: 220rpx; height: 300rpx;" mode="aspectFill"></image>
          </view>
          <view style="display: flex; flex-direction: column; padding-left: 20rpx;">
            <view style="font-size: 29rpx; font-weight: bold;">{{ item.name }}</view>
            <view style="font-size: 24rpx; margin-top: 15rpx; color: #808A9F;">{{ item.introduction }}
            </view>
          </view>
        </view>
      </view>
    </view>

  </view>
</template>

<script>
export default {
  data() {
    return {
      rankname: '',

      // æ¦œå•çƒ­åº¦
      hotRankList: [
        {
          articleId: 1,
          title: 'çµä¸è‚‰',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/coverpic/1.png',
          heat: 0,
        },
        {
          articleId: 2,
          title: 'ä¸€å°1846å¹´çš„æ‘„åƒæœº',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/2.png',
          heat: 0,
        },
        {
          articleId: 3,
          title: 'å‡å¦‚ä½ è§‚å¯Ÿä¸€ä¸ªå°å­©å­',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/3.png',
          heat: 0,
        },
        {
          articleId: 4,
          title: 'åƒçˆ±å› æ–¯å¦ä¸€æ ·æ€è€ƒ',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/4.png',
          heat: 0,
        },
        {
          articleId: 5,
          title: 'å¨æˆ¿ä¹‹æˆ˜',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/5.png',
          heat: 0,
        },
        {
          articleId: 6,
          title: 'æœ€å¾®å°çš„æ—…è¡Œ',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/6.png',
          heat: 0,
        },
        {
          articleId: 7,
          title: 'åƒçˆ±å› æ–¯å¦ä¸€æ ·æ€è€ƒ',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/4.png',
        },
        {
          articleId: 8,
          title: 'å¨æˆ¿ä¹‹æˆ˜',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/5.png',
        },
        {
          articleId: 9,
          title: 'æœ€å¾®å°çš„æ—…è¡Œ',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/6.png',
        },
        {
          articleId: 10,
          title: 'åƒçˆ±å› æ–¯å¦ä¸€æ ·æ€è€ƒ',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/4.png',
        },
      ],

      // æ¦œå•åˆ†ç±»
      ranklist: [
        {
          name: 'ç§‘æŠ€ç§‘æ™®æ¦œ',
          pics: [
            'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/ranklist1_1.png',
            'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/ranklist1_2.png',
            'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/ranklist1_3.png'
          ]
        },
        {
          name: 'æˆåŠŸåŠ±å¿—æ¦œ',
          pics: [
            'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/ranklist2_1.png',
            'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/ranklist2_2.png',
            'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/ranklist2_3.png'
          ]
        },
        {
          name: 'è‰ºæœ¯è®¾è®¡æ¦œ',
          pics: [
            'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/ranklist3_1.png',
            'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/ranklist3_2.png',
            'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/ranklist3_3.png'
          ]
        },
        {
          name: 'äººæ–‡ç¤¾ç§‘æ¦œ',
          pics: [
            'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/ranklist4_1.png',
            'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/ranklist4_2.png',
            'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/ranklist4_3.png'
          ]
        }
      ],

      // è¯»ç‰©æ¨è
      readingmaterials: [
        {
          name: 'è¯»è€…',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/readingmaterial_1.png',
          introduction: 'ã€Šè¯»è€…ã€‹åŸç§°ã€Šè¯»è€…æ–‡æ‘˜ã€‹ï¼Œå‘æ˜äººæ€§ä¸­çš„çœŸã€å–„ã€ç¾ï¼Œä½“ç°äººæ–‡å…³æ€€ï¼Œåœ¨åˆŠç‰©å†…å®¹åŠå½¢å¼æ–¹é¢ä¸æ—¶ä¿±è¿›ï¼Œè¿½æ±‚é«˜å“ä½ã€é«˜è´¨é‡ï¼ŒåŠ›æ±‚ç²¾å“ï¼Œå½¢å¼å’Œå†…å®¹å…·æœ‰ä¸°å¯Œæ€§åŠå¤šæ ·æ€§ï¼Œè¢«èª‰ä¸ºâ€œä¸­å›½äººçš„å¿ƒçµè¯»æœ¬â€ã€‚',
          homeurl: 'https://baike.baidu.com/item/%E8%AF%BB%E8%80%85/2643910?fr=ge_ala'

        },
        {
          name: 'æ„æ—',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/readingmaterial_2.png',
          introduction: 'æ„æ—æ˜¯ä¸€æœ¬ä»¥æ–‡å­¦ä¸ºä¸»çš„æ‚å¿—ï¼Œç”±ä¸­å›½ä½œå®¶åä¼šä¸»åŠã€‚å®ƒäº1979å¹´åˆ›åˆŠï¼Œæˆä¸ºä¸­å›½æœ€æ—©çš„æ–‡è‰ºç»¼åˆæ€§åˆŠç‰©ä¹‹ä¸€ã€‚æ„æ—ä¸»è¦ä»¥æ•£æ–‡ã€å°è¯´ã€è¯—æ­Œã€ä¹¦è¯„ç­‰ä¸ºä¸»è¦å†…å®¹ï¼Œæ¶µç›–äº†æ–‡å­¦ã€å†å²ã€å“²å­¦ã€ç¤¾ä¼šç§‘å­¦ç­‰é¢†åŸŸã€‚',
          homeurl: 'https://baike.baidu.com/item/%E6%84%8F%E6%9E%97/3565733?fr=ge_ala'

        },
        {
          name: 'é’å¹´æ–‡æ‘˜',
          pic: 'https://dingjiaxiong.oss-cn-hangzhou.aliyuncs.com/smartreading/readingmaterial_3.png',
          introduction: 'ã€Šé’å¹´æ–‡æ‘˜ã€‹æ˜¯ä¸€æœ¬é¢å‘å…¨å›½ã€ä»¥é’å°‘å¹´ä¸ºæ ¸å¿ƒè¯»è€…ç¾¤çš„æ–‡æ‘˜ç±»ç»¼åˆåˆŠç‰©ï¼ŒåˆŠç‰©é›†èƒæ¥è‡ªæŠ¥çº¸ã€æœŸåˆŠã€å›¾ä¹¦ç­‰å¤§ä¼—åª’ä½“çš„åç¯‡ä½³ä½œï¼Œæ—¨åœ¨ä¸ºé’å°‘å¹´æ‰“é€ ä¸€ä¸ªä¸°å¯Œç”ŸåŠ¨ã€å¥åº·å‘ä¸Šçš„ç²¾ç¥ç©ºé—´ã€‚',
          homeurl: 'https://baike.baidu.com/item/%E9%9D%92%E5%B9%B4%E6%96%87%E6%91%98/179910?fr=ge_ala'
        }
      ]
    }
  },

  onLoad() {
    uni.setTabBarItem({
      index: 0,
      text: ''
    });

    uni.setTabBarItem({
      index: 1,
      text: ''
    });

    uni.setTabBarItem({
      index: 2,
      text: 'æ’è¡Œæ¦œ'
    });

    uni.setTabBarItem({
      index: 3,
      text: ''
    });

    this.getAllHeatsFromDb()
  },

  onShow() {
    // æ¯æ¬¡æŸ¥çœ‹çš„æ—¶å€™éƒ½åˆ·æ–°æ¦œå•
    this.getAllHeatsFromDb()
  },

  // æ¥ä¸€ä¸ªç›‘å¬åº•éƒ¨å¯¼èˆªæ è¢«ç‚¹å‡»çš„æ–¹æ³•
  onTabItemTap: function (e) {
    // console.log(e);
    // eçš„è¿”å›æ ¼å¼ä¸ºjsonå¯¹è±¡ï¼š {"index":0,"text":"é¦–é¡µ","pagePath":"pages/index/index"}
    uni.setTabBarItem({
      index: 0,
      text: ''
    });

    uni.setTabBarItem({
      index: 1,
      text: ''
    });

    uni.setTabBarItem({
      index: 2,
      text: 'æ’è¡Œæ¦œ'
    });

    uni.setTabBarItem({

      index: 3,
      text: ''
    });
  },

  methods: {
    torankdetail(name) {
      uni.navigateTo({
        url: '../leaderboard/rankdetail/rankdetail?name=' + name,
        success: res => {
          console.log("è·³è½¬æˆåŠŸ");
        },
        fail: () => {
        },
        complete: () => {
        }
      });
    },

    tomaterialdetail(homeurl) {
      uni.navigateTo({
        url: '../leaderboard/readingmaterialdetail/readingmaterialdetail?url=' + homeurl,
        success: res => {
          console.log("è·³è½¬æˆåŠŸ");
        },
        fail: () => {
        },
        complete: () => {
        }
      });
    },

    getAllHeatsFromDb() {
      uni.request({
        url: `http://114.215.189.9:8088/heat/getAllHeats`,
        method: 'GET',
        success: res => {
          this.hotRankList = res.data; // å…ˆä¿å­˜çƒ­åº¦æ•°æ®
          const selectIds = res.data.map(item => item.articleId); // æå–æ–‡ç« IDåˆ—è¡¨

          // è·å–æ–‡ç« è¯¦ç»†ä¿¡æ¯
          uni.request({
            url: 'http://123.56.217.170:2222/api/article/getarticlesinfobyids',
            method: 'POST',
            data: selectIds,
            success: res => {
              // æŠŠæ–‡ç« ä¿¡æ¯è½¬æ¢æˆ Map ç»“æ„ï¼Œæ–¹ä¾¿åŒ¹é…
              const articleMap = new Map(res.data.map(article => [article.articleId, article]));

              // éå† hotRankListï¼ŒæŠŠæ–‡ç« è¯¦ç»†ä¿¡æ¯è¡¥å……è¿›å»
              this.hotRankList = this.hotRankList.map(item => ({
                ...item,
                pic: articleMap.get(item.articleId)?.coverpic || '', // é¿å… undefined
                title: articleMap.get(item.articleId)?.title || 'æœªçŸ¥æ ‡é¢˜'
              }));
            },
            fail: err => {
              console.error("ğŸš¨ è·å–æ–‡ç« ä¿¡æ¯å¤±è´¥", err);
            }
          });
        },
        fail: err => {
          console.error("ğŸš¨ è¯·æ±‚çƒ­åº¦æ•°æ®å¤±è´¥", err);
        }
      });
    }
  }
}
</script>

<style lang="scss" scoped>
.status_bar {
  height: var(--status-bar-height);
  width: 100%;

}


.top_view {
  height: var(--status-bar-height);
  width: 100%;
  position: fixed;
  background-color: white;
  top: 0;
  z-index: 999;
}

.ranklist {
  /* background-color: aquamarine; */
  /* width: 1; */
  padding: 20rpx;
  height: auto;
}

.recommendedreadingmaterial {
  padding: 20rpx;
  height: auto;
}

.container {
  display: flex;
  flex-direction: column;
}

.row {
  display: flex;
}

.item {
  flex: 1;
  height: 300rpx;
  text-align: center;
  background-color: #f0f0f0;
  margin: 5px;

  width: 47.6%;
}


.page {
  margin-top: 10rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%; /* é¡µé¢å®½åº¦è‡ªé€‚åº” */
}

.header {
  display: flex;
  flex-direction: column;
  align-items: center;
  color: #fff;
  padding-bottom: 20rpx;
  width: 100%; /* è‡ªé€‚åº”å®½åº¦ */
}

.header-title {
  background: #F2856E;
  width: 40%; /* ä½¿ç”¨ç™¾åˆ†æ¯”æ¥è®©æ ‡é¢˜å®½åº¦è‡ªé€‚åº” */
  max-width: 400rpx; /* é™åˆ¶æœ€å¤§å®½åº¦ */
  height: 50rpx;
  border-radius: 16rpx;
  font-size: 20rpx;
  text-align: center;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
}

.header-title image {
  width: 40rpx;
  height: 40rpx;
  margin-right: 8rpx;
}

.ranking {
  margin-left: 5%;
  margin-right: 5%;
  border-radius: 30rpx;
  box-sizing: border-box;
  padding: 5rpx;
  background: #EAEFF1;
  width: 90%; /* è‡ªé€‚åº”å®½åº¦ */
}

.ranking-title {
  display: flex;
  align-items: center;
  font-weight: bold;
  width: 100%;
}

.ranking-title text {
  text-align: center;
  font-size: 20rpx;
}

.ranking-title text:nth-child(1) {
  width: 15%; /* æ’ååˆ—å  15% */
  text-align: left;
}

.ranking-title text:nth-child(2) {
  flex-grow: 2; /* è®©æ–‡ç« åˆ—å æ›´å¤šç©ºé—´ */
  text-align: center;
  padding-left: 10rpx;
}

.ranking-title text:nth-child(3) {
  width: 25%; /* çƒ­åº¦å€¼åˆ—å  20% */
  text-align: right;
}

.separator {
  width: 3rpx;
  height: auto;
  flex-shrink: 0;
  background-color: white;
  margin: 0 20rpx;
}

.ranking-sum {
  display: flex;
  justify-content: center;
  align-items: stretch;
  width: 100%;
}

.ranking-list {
  width: 48%; /* æ¯ä¸ªæ¦œå•å  48% */
  padding: 10px;
  border-radius: 10px;
  margin: 1%; /* ç•™å‡ºé—´éš™ */
}

.ranking-list-item {
  display: flex;
  align-items: center;
  height: 80rpx;
  font-size: 13rpx;
}

.ranking-list-number {
  width: 15%;
  text-align: center;
  color: #777;
}

.ranking-list-number image {
  width: 25rpx;
  height: 25rpx;
}

.ranking-list-nickname {
  display: flex;
  align-items: center;
  width: 65%;
  padding-left: 10rpx;
}

.ranking-list-nickname image {
  width: 30rpx;
  height: 30rpx;
  border-radius: 50%;
  margin-right: 10rpx;
  flex-shrink: 0;
}

.ranking-list-nickname text {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
}

.ranking-list-score {
  width: 25%; /* çƒ­åº¦å€¼åˆ—å  20% */
  text-align: center;
  color: #E28935;
  font-size: 16rpx;
}
</style>